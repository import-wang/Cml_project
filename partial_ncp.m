function [ncp, nabla_ncp,nabla_obj] = partial_ncp(xk,xk_1,xk_2,t1,t2)
% ans = [((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-(t1*xk_2^2)/4))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)^2) + (2*((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-(t1*xk_2^2)/4))/pi^(1/2)))/((2*xk - 2*xk_2)^2*(xk - xk_1)) + ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-(t2*xk_2^2)/4))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)^2) + (2*((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-(t2*xk_2^2)/4))/pi^(1/2)))/((2*xk - 2*xk_2)^2*(xk - xk_1)), xk_1 + erfc(xk_1/(2*t2^(1/2))) + (xk_1 + erfc(xk_1/(2*t1^(1/2))) + (t1^(3/2)*xk_1*exp(-(t1*xk_1^2)/4))/pi^(1/2) - (xk_1*exp(-xk_1^2/(4*t1)))/(t1^(1/2)*pi^(1/2)) - 1)/(t1 - t2) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-(t1*xk_2^2)/4))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)^2) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-(t2*xk_2^2)/4))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)^2) + (t2^(3/2)*xk_1*exp(-(t2*xk_1^2)/4))/pi^(1/2) - (xk_1*exp(-xk_1^2/(4*t2)))/(t2^(1/2)*pi^(1/2)) - 1, 2*xk_2 + erfc(xk_2/(2*t1^(1/2))) + erfc(xk_2/(2*t2^(1/2))) - (2*((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-(t1*xk_2^2)/4))/pi^(1/2)))/((2*xk - 2*xk_2)^2*(xk - xk_1)) - (2*((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-(t2*xk_2^2)/4))/pi^(1/2)))/((2*xk - 2*xk_2)^2*(xk - xk_1)) - (xk_2 + erfc(xk_2/(2*t1^(1/2))) + (t1^(3/2)*xk_2*exp(-(t1*xk_2^2)/4))/pi^(1/2) - (xk_2*exp(-xk_2^2/(4*t1)))/(t1^(1/2)*pi^(1/2)) - 1)/((2*xk - 2*xk_2)*(xk - xk_1)) - (xk_2 + erfc(xk_2/(2*t2^(1/2))) + (t2^(3/2)*xk_2*exp(-(t2*xk_2^2)/4))/pi^(1/2) - (xk_2*exp(-xk_2^2/(4*t2)))/(t2^(1/2)*pi^(1/2)) - 1)/((2*xk - 2*xk_2)*(xk - xk_1)) + (t1^(3/2)*xk_2*exp(-(t1*xk_2^2)/4))/pi^(1/2) + (t2^(3/2)*xk_2*exp(-(t2*xk_2^2)/4))/pi^(1/2) - (xk_2*exp(-xk_2^2/(4*t1)))/(t1^(1/2)*pi^(1/2)) - (xk_2*exp(-xk_2^2/(4*t2)))/(t2^(1/2)*pi^(1/2)) - 2];
% fdc = (xk_1 - 1)^2/2 + (xk_2 - 1)^2 + ((xk_1 - 1)^2/2 + xk_1*erfc(xk_1/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-(t1*xk_1^2)/4))/pi^(1/2))/(t1 - t2) + xk_1*erfc(xk_1/(2*t2^(1/2))) + xk_2*erfc(xk_2/(2*t1^(1/2))) + xk_2*erfc(xk_2/(2*t2^(1/2))) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-(t1*xk_2^2)/4))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-(t2*xk_2^2)/4))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) - (2*t1^(1/2)*exp(-(t1*xk_2^2)/4))/pi^(1/2) - (2*t2^(1/2)*exp(-(t2*xk_1^2)/4))/pi^(1/2) - (2*t2^(1/2)*exp(-(t2*xk_2^2)/4))/pi^(1/2) + 1;
% cxt = 0.5 * (1-x)^2 - 2 * sqrt(t/pi) * exp(-(x/2 * sqrt(t))^2) + x * erfc(x/(2*sqrt(t)));
% f_fun  = (xk_1 - 1)^2/2 + (xk_2 - 1)^2 + ((xk_1 - 1)^2/2 + xk_1*erfc(xk_1/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_1^2/(4*t1)))/pi^(1/2))/(t1 - t2) + xk_1*erfc(xk_1/(2*t2^(1/2))) + xk_2*erfc(xk_2/(2*t1^(1/2))) + xk_2*erfc(xk_2/(2*t2^(1/2))) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2) - (2*t2^(1/2)*exp(-xk_1^2/(4*t2)))/pi^(1/2) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2) + 1;
ncp = (((xk - 1)^2/2 + xk*erfc(xk/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk^2/(4*t1)))/pi^(1/2))^2 + ((xk_1 - 1)^2/2 + (xk_2 - 1)^2 + ((xk_1 - 1)^2/2 + xk_1*erfc(xk_1/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_1^2/(4*t1)))/pi^(1/2))/(t1 - t2) + xk_1*erfc(xk_1/(2*t2^(1/2))) + xk_2*erfc(xk_2/(2*t1^(1/2))) + xk_2*erfc(xk_2/(2*t2^(1/2))) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2) - (2*t2^(1/2)*exp(-xk_1^2/(4*t2)))/pi^(1/2) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2) + 1)^2)^(1/2) - (xk_1 - 1)^2/2 - (xk_2 - 1)^2 - (xk - 1)^2/2 - ((xk_1 - 1)^2/2 + xk_1*erfc(xk_1/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_1^2/(4*t1)))/pi^(1/2))/(t1 - t2) - xk*erfc(xk/(2*t1^(1/2))) - xk_1*erfc(xk_1/(2*t2^(1/2))) - xk_2*erfc(xk_2/(2*t1^(1/2))) - xk_2*erfc(xk_2/(2*t2^(1/2))) + ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) + ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) + (2*t1^(1/2)*exp(-xk^2/(4*t1)))/pi^(1/2) + (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2) + (2*t2^(1/2)*exp(-xk_1^2/(4*t2)))/pi^(1/2) + (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2) - 1;
nabla_ncp = (2*((xk - 1)^2/2 + xk*erfc(xk/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk^2/(4*t1)))/pi^(1/2))*(xk + erfc(xk/(2*t1^(1/2))) - 1) + 2*(((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)^2) + (2*((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2)))/((2*xk - 2*xk_2)^2*(xk - xk_1)) + ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)^2) + (2*((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2)))/((2*xk - 2*xk_2)^2*(xk - xk_1)))*((xk_1 - 1)^2/2 + (xk_2 - 1)^2 + ((xk_1 - 1)^2/2 + xk_1*erfc(xk_1/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_1^2/(4*t1)))/pi^(1/2))/(t1 - t2) + xk_1*erfc(xk_1/(2*t2^(1/2))) + xk_2*erfc(xk_2/(2*t1^(1/2))) + xk_2*erfc(xk_2/(2*t2^(1/2))) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2) - (2*t2^(1/2)*exp(-xk_1^2/(4*t2)))/pi^(1/2) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2) + 1))/(2*(((xk - 1)^2/2 + xk*erfc(xk/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk^2/(4*t1)))/pi^(1/2))^2 + ((xk_1 - 1)^2/2 + (xk_2 - 1)^2 + ((xk_1 - 1)^2/2 + xk_1*erfc(xk_1/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_1^2/(4*t1)))/pi^(1/2))/(t1 - t2) + xk_1*erfc(xk_1/(2*t2^(1/2))) + xk_2*erfc(xk_2/(2*t1^(1/2))) + xk_2*erfc(xk_2/(2*t2^(1/2))) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2) - (2*t2^(1/2)*exp(-xk_1^2/(4*t2)))/pi^(1/2) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2) + 1)^2)^(1/2)) - erfc(xk/(2*t1^(1/2))) - xk - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)^2) - (2*((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t1^(1/2))) - (2*t1^(1/2)*exp(-xk_2^2/(4*t1)))/pi^(1/2)))/((2*xk - 2*xk_2)^2*(xk - xk_1)) - ((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2))/((2*xk - 2*xk_2)*(xk - xk_1)^2) - (2*((xk_2 - 1)^2/2 + xk_2*erfc(xk_2/(2*t2^(1/2))) - (2*t2^(1/2)*exp(-xk_2^2/(4*t2)))/pi^(1/2)))/((2*xk - 2*xk_2)^2*(xk - xk_1)) + 1;
nabla_obj = ncp * nabla_ncp;